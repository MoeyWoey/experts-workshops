<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>قائمة الحضور</title>
    <!-- Bootstrap 4.5.2 CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { 
            font-family: 'Tahoma', sans-serif;
            background-color: #fff; /* Ensure a white background for printing */
        }
        .container { 
            padding-top: 20px;
        }
        /* Ensure text is right-aligned for RTL */
        h1, h2, th, td { 
            text-align: right; 
        }
        .print-header { 
            border-bottom: 2px solid #000; 
            margin-bottom: 20px; 
            padding-bottom: 10px; 
        }
        /* Styles specifically for printing */
        @media print {
            body { 
                -webkit-print-color-adjust: exact; /* Helps with printing background colors in some browsers */
            }
            .no-print { 
                display: none; /* Hide any elements with this class when printing */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="print-header">
            <h1 id="workshopTitle">قائمة الحضور</h1>
            <h2 id="printDate" class="text-muted small"></h2>
        </div>
        
        <table class="table table-striped table-bordered">
            <thead class="thead-light">
                <tr>
                    <th style="width: 5%;">#</th>
                    <th>اسم المسجل</th>
                    <th>البريد الإلكتروني</th>
                </tr>
            </thead>
            <tbody id="attendeesTableBody">
                <!-- Rows will be populated by JavaScript -->
            </tbody>
        </table>

        <p id="loadingMessage" class="text-center">جاري تحميل قائمة الحضور...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const workshopId = urlParams.get('workshop_id');

            const titleElement = document.getElementById('workshopTitle');
            const dateElement = document.getElementById('printDate');
            const tableBody = document.getElementById('attendeesTableBody');
            const loadingMessage = document.getElementById('loadingMessage');

            // Set the print date immediately
            const today = new Date();
            dateElement.textContent = `تاريخ الطباعة: ${today.toLocaleDateString('ar-KW')}`;

            if (!workshopId) {
                titleElement.textContent = 'خطأ: لم يتم تحديد ورشة العمل.';
                loadingMessage.style.display = 'none';
                return;
            }

            fetch(`api/admin_get_attendees.php?workshop_id=${workshopId}`)
                .then(response => response.json())
                .then(data => {
                    if (!data.success) {
                        throw new Error(data.message);
                    }
                    
                    titleElement.textContent = `قائمة الحضور لورشة: ${data.workshop_title}`;
                    
                    if (data.attendees.length === 0) {
                        tableBody.innerHTML = '<tr><td colspan="3" class="text-center">لا يوجد مشاركون مؤكدون في هذه الورشة.</td></tr>';
                    } else {
                        data.attendees.forEach((attendee, index) => {
                            const row = `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${attendee.full_name}</td>
                                    <td>${attendee.email}</td>
                                </tr>
                            `;
                            tableBody.innerHTML += row;
                        });
                    }

                    // Hide the loading message and trigger print dialog
                    loadingMessage.style.display = 'none';
                    window.print();

                })
                .catch(error => {
                    console.error('Error fetching attendees:', error);
                    titleElement.textContent = 'خطأ في تحميل البيانات';
                    loadingMessage.textContent = 'لم نتمكن من تحميل قائمة الحضور. يرجى التأكد من الرابط والمحاولة مرة أخرى.';
                });
        });
    </script>
</body>
</html>

